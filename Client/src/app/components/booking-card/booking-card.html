<p-card class="flex flex-col h-full w-full rounded-lg shadow-md px-4">
  <div class="flex justify-between md:items-center items-start md:flex-row flex-col">
    <div class="info">
      <div class="title flex items-center gap-3 mb-3">
        <h2 class="font-semibold text-xl">Booking #{{ currentBooking()!.id }}</h2>
        <span
          class="text-white px-2 py-1 rounded text-sm font-medium"
          [ngClass]="getStatusClass(currentBooking()!.status)"
        >
          {{ currentBooking()!.status }}
        </span>

        <button
          pButton
          type="button"
          icon="pi pi-info-circle"
          class="p-button-text p-button-sm"
          (click)="goToBooking()"
          title="View Booking Details"
        ></button>

        @if(showEditButton()){
        <button
          pButton
          type="button"
          icon="pi pi-pencil"
          class="p-button-text p-button-sm"
          (click)="toggleEditDialog()"
          title="Edit Booking"
        ></button>
        }
      </div>
      <p><strong>From:</strong> {{ currentBooking()!.startDate | bookingDate }}</p>
      <p><strong>To:</strong> {{ currentBooking()!.endDate | bookingDate }}</p>
      <p><strong>Venue:</strong> {{ currentBooking()!.venueName }}</p>
    </div>
    <div class="actions md:mt-0 mt-4 flex gap-2">
      @if(showApproveButton()) {
      <button pButton label="Approve" (click)="approveBooking(booking().id)"></button>
      } @if (showRejectButton()) {
      <button
        pButton
        label="Reject"
        (click)="rejectBooking(currentBooking()!.id)"
        severity="secondary"
      ></button>
      } @if(showCancelButton()) {
      <button
        pButton
        label="Cancel Booking"
        (click)="confirmCancelBooking(currentBooking()!.id)"
        severity="secondary"
      ></button>
      } @if (showReopenButton()) {
      <button
        pButton
        label="Reopen Booking"
        (click)="reopenBooking(currentBooking()!.id)"
        severity="secondary"
      ></button>
      } @if (currentBooking()?.status === 'Approved' && currentBooking()?.isPaid === false &&
      this.isUsersBooking()) {
      <button
        pButton
        label="Pay Now"
        icon="pi pi-credit-card"
        (click)="goToPay()"
        severity="success"
      ></button>
      }@else if(currentBooking()?.isPaid === true && this.isUsersBooking()){
      <div class="bg-green-50 px-3 py-2 rounded">
        <div class="flex items-center gap-2">
          <i class="pi pi-check-circle text-green-600 text-xl"></i>

          <div>
            <p class="text-green-800">
              Amount Paid:
              <span class="font-bold">
                {{ currentBooking()?.amountPaid | currency : 'RON' : 'symbol' : '1.2-2' }}
              </span>
            </p>
          </div>
        </div>
      </div>
      }
    </div>
  </div>
</p-card>

<p-dialog
  [(visible)]="showEditDialog"
  header="Edit Booking #{{ currentBooking()!.id }}"
  [modal]="true"
  [closable]="true"
  [draggable]="false"
  [style]="{ width: 'fit-content' }"
>
  <app-add-or-edit-booking-card
    [booking]="currentBooking()!"
    (onBookingEdited)="onBookingEdited($event)"
  />
</p-dialog>

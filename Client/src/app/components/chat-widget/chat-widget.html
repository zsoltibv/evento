<!-- Floating Chat Button -->
<button
  pButton
  type="button"
  icon="pi pi-comments"
  class="chat-fab bg-primary text-white rounded-full shadow-lg hover:scale-105 transition-transform fixed right-6 bottom-6 z-50"
  (click)="op.toggle($event)"
></button>

<!-- Popover Chat Window -->
<p-popover #op [dismissable]="true" class="w-[25rem]">
  <div class="flex flex-col h-[400px]">
    <div class="bg-primary text-white text-center p-2 font-semibold">
      Chat with {{ chatOwnerName() || 'Support Agent' }}
    </div>
    <!-- Chat messages -->
    <div class="flex-1 overflow-y-auto p-3 flex flex-col gap-2 rounded-t-lg">
      @if(messages().length === 0){
      <p class="text-gray-500 text-center mt-5">No messages yet.</p>
      } @else { @for(msg of messages(); track $index){
      <div
        [ngClass]="{
          'self-end bg-blue-500 text-white': msg.sender.userId === currentUserId(),
          'self-start bg-gray-200 text-gray-900': msg.sender.userId !== currentUserId()
        }"
        class="p-2 rounded-lg max-w-[80%] break-words"
      >
        {{ msg.messageText }}
      </div>
      } }
    </div>

    <!-- Input area -->
    <div class="flex p-2 border-gray-300 gap-2">
      <input
        pInputText
        placeholder="Type your message..."
        [value]="messageText()"
        (input)="messageText.set($any($event.target).value)"
        (keydown.enter)="sendMessage(); $event.preventDefault()"
        class="flex-1 border rounded p-2"
      />
      <button
        pButton
        type="button"
        icon="pi pi-send"
        (click)="sendMessage()"
        [disabled]="!messageText()"
        class="h-10"
      ></button>
    </div>
  </div>
</p-popover>
